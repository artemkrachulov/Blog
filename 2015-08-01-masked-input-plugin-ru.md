При разработке большинства приложений, я столкнулся с проблемой ввода данных в поле с использованием маски (кредитные карточки, телефонные номера и др.) Казалось бы, можно использовать обычное регулярное выражение, но хотесь немного большего количества настроек. Я принялся искать подходящий плагин написанный на языке Swift, но такового не нашел. Даже поиски плагина на предыдущем языке Objective-C с оказались без результатными. Тогда я подумал, почему бы не написать свой, небольшой но универсальный плагин.

## Что такое AKMaskField?

AKMaskField это плагин написанный на языке Swift.

AKMaskField позволяет пользователю легко ввести данные в фиксированном количестве и формате (кредитные карточки, телефонные номера, даты и т.д.). Разработчику необходимо настроить формат маски и шаблон. Маска состоит из символов и блоков. Каждый блок состоит из символов определенного типа (цифрыа буква, символ). Шаблон в свою очередь представляет саму маску со скрытыми символами в каждом боке.

**Основные особенности:**

* простой в использовании
* возможность настройки из кода или Панели Настроек
* умный шаблон
* колбэк статуса и действия
* поддержка динамического изменения маски
* быстрая обработка поля
* умный ввод при действиях пользователя: копировать / вставить

![Демо](https://raw.githubusercontent.com/artemkrachulov/AKMaskField/master/Assets/preview.png)

## Использование

Добавьте файл _AKMaskField.swift_ в проект (Копировать файл должно быть выбрано). Создайте поле класса _UITextField_ и укажите ему класс _AKMaskField_ в Панели Инспектора / Принадлежность. Во вкладке Атрибуты или в коде укажите необходимые атрибуты:

**Вкладка Атрибуты**

``` text
Mask: {dddd}-{dddd}-{dddd}-{dddd}
Mask Template: xxxx-xxxx-xxxx-xxxx
Mask Show Template: On

// Поле ввода
xxxx-xxxx-xxxx-xxxx

// Ручной ввод значения по умолчанию
Text: 0123

// Поле ввода
0123-xxxx-xxxx-xxxx
```

**Код**

``` swift
field.mask = "{dddd}-{dddd}-{dddd}-{dddd}"
field.maskTemplate = "xxxx-xxxx-xxxx-xxxx"
field.maskShowTemplate = true

// Поле ввода
xxxx-xxxx-xxxx-xxxx

// Значение по умолчанию
field.text = 0123

// Поле ввода
0123-xxxx-xxxx-xxxx
```

## Свойства

### Маска

`.mask` свойство / _mask_ ключ / **Mask** атрибут

**Тип**: Строка

**Доступ**: Можно изменять и обращаться

**По умолчанию**: {` ... `}`

Определяет вид маски. Строка содержит блоки с символами резделенными любой строкой вне блоков. Блоки открывает и закрывает специальный символ.

Символы внутри блока соответствуют определённому типу данных. Предопределённые типы:

* **d** - Цифра, десятичная цифра от 0 до 9
* **D** - Любому символу, кроме десятичной цифры
* **W** - Не алфавитный символ
* **a** - Алфавитный символ, a-Z
* **.** - Соответствует любому символу (по умолчанию)

Пример:

``` text
{dddd}-{DDDD}-{WaWa}-{aaaa}
```

### Шаблон

`.maskTemplate` свойство / _maskTemplate_ ключ / **Mask Template** атрибут

**Тип**: Строка

**Доступ**: Можно изменять и обращаться

**По умолчанию**: __*__

Шаблон текста со скрытыми символами маски который видит пользователь. Может быть в виде:

* **1 символ**

  В этом случае символ будет скопирован в соответствии длины каждого блока маски.

Пример:

``` text
// Маска
{dddd}-{DDDD}-{WaWa}-{aaaa}

// Шаблон
Z

// Вывод текста в поле
ZZZZ-ZZZZ-ZZZZ-ZZZZ
```

* **Разные символы**

  В этом случае количество символов шаблона должно соответствовать количеству символов маски без учета скобок.

Пример:

``` text
// Маска
// 19 символов
{dddd}-{DDDD}-{WaWa}-{aaaa}

// Шаблон
// 19 символов
ABCD-EFGH-IJKL-MNOP

// Вывод текста в поле
ABCD-EFGH-IJKL-MNOP
```

### Видимый шаблон

`.maskShowTemplate` свойство / _maskShowTemplate_ ключ / **Mask Show Template** атрибут

**Тип**: Булевый

**Доступ**: Можно изменять и обращаться

**По умолчанию**: false (По умолчанию)

Указывает на то, будет ли видим шаблон если поле не содержит введенных символов и имеет статус "Пустое" поле. Может иметь 2 состояния:

* **On (true)** - Шаблон виден всегда. Заменяет заполнитель поля.
* **Off (false)** - Шаблон отображается, если поле содержит введенные символы. Если поле не имеет введенных пользователем символов, то будет отображаться стандартный заполнитель поля.

### Открывающий и закрывающий символ блока

`.maskBlockBrackets` свойство

**Тип**: Массив

**Доступ**: Можно изменять и обращаться

**По умолчанию**: `{` и `}`

Два символа. Изменяется только в коде.

Пример:

``` swift
// Скобки
field.maskBlockBrackets = ["[", "]"]

// Маска
field.mask = [dddd]-[DDDD]-[WaWa]-[aaaa]
```

### Объект

`.maskObject` свойство

**Тип**: Массив

**Доступ**: Можно обращаться

**По умолчанию**: Пустой

Содержит в себе информацию о блоках.

Пример:

``` swift
// Возьмём первый блок
let block = self.field.maskObject[0]

print("Позиция блока в маске: \(block.index)") // Int
print("Заполнен или не заполнен блок: \(block.status)") // true - Заполнен, false - не заполнен
print("Месторасположение блока в маске: \(block.range)") // Range<Int>
print("Маска: \(block.mask)") // String
print("Шаблон: \(block.template)") // String
print("Символы внури внутри: \(block.chars)") // Array<AKMaskFieldBlockChars>

// Возьмём первый символ
let char = block.chars[0]

print("Заполнен или не заполнен символ : \(char.status)") // true - Заполнен, false - не заполнен
print("Месторасположение символa в маске: \(char.range)") // Range<Int>
```

### Статус маски

`.maskStatus` свойство

**Тип**: Перечисление

**Доступ**: Можно обращаться

**По умолчанию**: `.Clear` - чистое

Указывает на состояние поля в текущий момент. Поле имеет 3 состояния:

* **.Clear** - Пустое (чистое), нет заполненных символов
* **.Incomplete** - Не заполненное, хотя бы один символ введен
* **.Complete** - Заполненное, все символы введены

### Действие пользователя

`.maskEvent` свойство

**Тип**: Перечисление

**Доступ**: Можно обращаться

**По умолчанию**: `.None`

Указывает на действие пользователя. Пользователь может совершать 4 действия:

* **.None** - Нет действий
* **.Insert** - Ввод
* **.Delete** - Удаление
* **.Replace** - Выделение и ввод символа

### Делегаты

`.maskDelegate` свойство

Указывают на событие которые пользователь выполняет с полем ввода. Опциональные методы. События:

* maskFieldDidBeginEditing(maskField: AKMaskField)

  Вызывается когда курсор установлен в поле

* maskField(maskField: AKMaskField, shouldChangeCharacters oldString: String, InRange range: NSRange, replacementString withString: String)

  Вызывается когда пользователь выполняет действие

Пример:

``` swift
override func viewDidLoad() {
  super.viewDidLoad()

  field.maskDelegate = self
}

// Методы делегата
func maskFieldDidBeginEditing(maskField: AKMaskField) {
    print("Объект класса: \(maskField)")
}

func maskField(maskField: AKMaskField, shouldChangeCharacters oldString: String, InRange range: NSRange, replacementString withString: String) {
    print("Объект класса: \(maskField)")
    print("Текст до события: \(maskField.oldString)")
    print("Месторасположение текста до события: \(maskField.range)")
    print("Текст после события: \(maskField.withString)")
    print("Состояние поля после события: \(maskField.maskStatus)")
    print("Действие в момент события: \(maskField.maskEvent)")
}
```

### Автор

Артем Крачулов: [Вебсайт](http://www.artemkrachulov.com/), [artem.krachulov@gmail.com](artem.krachulov@gmail.com)

### Лицензия

[MIT license](http://www.opensource.org/licenses/MIT)
